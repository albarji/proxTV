language: python
matrix:
    include:
        - os: linux
          sudo: required
          python: "2.7"
          dist: trusty

        - os: linux
          sudo: required
          python: "3.4"
          dist: trusty

        - os: linux
          sudo: required
          python: "3.5"
          dist: trusty

        - os: linux
          sudo: required
          python: "3.6"
          dist: trusty

        - os: osx
          language: generic
          python: "2.7"

        - os: osx
          language: generic
          python: "3.4"

        - os: osx
          language: generic
          python: "3.5"

        - os: osx
          language: generic
          python: "3.6"

sudo: required
install:
    - docker pull quay.io/pypa/manylinux1_x86_64
    - pip install coveralls
script:
    # Get python version without dot, wheel packaging version
    - export PYTHONVERSION=$(echo ${TRAVIS_PYTHON_VERSION} | tr -d .)
    - export PACKAGING=$([[ ${PYTHONVERSION} = "27" ]] && echo "mu" || echo "m")
    # Build precompiled python wheels
    - docker run --rm -it -v $(pwd):/io quay.io/pypa/manylinux1_x86_64 bash -c "cd /io; bash buildwheels.sh"
    # Install wheel for this with version
    - pip install wheelhouse/prox_tv-*-cp${PYTHONVERSION}-cp${PYTHONVERSION}${PACKAGING}-manylinux1_x86_64.whl
    # Unit tests
    - nosetests --with-coverage --cover-package=prox_tv
after_success:
    - coveralls
